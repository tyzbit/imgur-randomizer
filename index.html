<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<title>Random Imgur generator -  Choose number of images - Best Imgur Roulette</title>
	<meta name="Description" content="Choose the number of random images you see. Not affiliated with Imgur.">
	<script type='text/javascript' src='http://code.jquery.com/jquery-1.5.2.js'></script>
	<script type='text/javascript' src='masonry.pkgd.min.js'></script>
	<link rel="stylesheet" type="text/css" href="style.css" />
<center>
<div id=topbar>
<div id=topbar_right></div>
</div>
<script type='text/javascript'>
	imgurcache = new Array()
	a=window.innerWidth;
	b=window.innerHeight;
	var loadimages = Math.round(( ( a * b ) * -.000002471085214138067 ) + 40.72076119301664);
	function resized() {
				a=window.innerWidth;
				b=window.innerHeight;
				loadimages = Math.round(( ( a * b ) * -.000002471085214138067 ) + 40.72076119301664);
		}
		$( window ).resize(function() {
				resized();
		});
		$(window).blur(function(){
			$('#stahp').click();
		});
		$(window).load(function(){
		resized();
		var Imgur = {
			fetch: function(num) {
				var self=this;
				self.total=num;
				self.done=0;
				self.done2=0;
				self.failures=0;
				self.start=+new Date;

				$('#images').empty();
				for (var x = 0; x < num; x++) {
					self.hunt(function(id) {
						self.done++;
						self.done2++;
						self.skip=Math.floor((Math.random()*40)+25);
						$('#images').append("<a href='http://i.imgur.com/" + id + ".jpg' class='item' id='i' target='_blank' rel='noreferrer'><img src='http://i.imgur.com/" + id + "s.png' width='10.5%' /></a>");
						if(self.done2>self.skip) {
							self.done2=0;
						}
						//self.update();
					});
				}
			},
			update: function() {
				var interval=new Date-this.start;
				function speed(v) { return (~~(v/interval*1e5))/100; }
				$('#info').html((this.done<this.total?"Loading.. "+this.done+"/"+this.total+" ("+this.failures+" failures"+") ":"Done. ")+"["+speed(this.failures+this.done)+" req/s - "+speed(this.done)+" img/s]");
			},
			
			hunt: function(cb) {
				var self=this,
					id = self.random(5),
					img = new Image;
						//self.update();
						img.src = "http://i.imgur.com/"+id+"s.png";
						img.onload = function() {
							if ((img.width==198 && img.height==160) || (img.width==161 && img.height==81)) {
								// assume this is an imgur error image, and retry.
								fail();
							} else {
								cb(id);
							}
						}
						img.onerror = fail; // no escape.
				function fail() {
					self.failures++;
					//self.update();
					self.hunt(cb);
				}
			},
			random: function(len) {
				var text = new Array();
				var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
				for (var i=0; i < len; i++) {
					imgurchar = possible.charAt(Math.floor(Math.random() * possible.length));
					if (text.indexOf(imgurchar) == -1) {
						text.push(imgurchar);
					} else {
						i--;
					}
				}
				text = text.join('');
				if (imgurcache.indexOf(text) == -1) {
					imgurcache.push(text);
					return text;
				} else {
					self.random(5);
					return false;
				}
			}
		};

		$('#random').bind('click', function(e) {
			Imgur.fetch(loadimages);
		});
		$('#automatic').bind('click', function() {
			refreshVar = window.setInterval(function(){Imgur.fetch(loadimages)},10000);
			Imgur.fetch(loadimages);
	                $('img').live('click', function() {
	                        $('#stahp').click();
	               	});
		});
                $('#minutes').bind('click', function() {
                        refreshVar = window.setInterval(function(){Imgur.fetch(loadimages)},180000);
                        Imgur.fetch(loadimages);
                        $('img').live('click', function() {
                                $('#stahp').click();
                        });
                });
		$('#stahp').bind('click', function(e) {
			window.clearInterval(refreshVar);
		});
		$(document).keyup(function(e) {
			if (e.keyCode == 27) { $('#stahp').click(); }
			if (e.keyCode == 82) { $('#random').click(); }
			if (e.keyCode == 69) { resized() }
		});
	});
</script></head>
	<body>
	<div id="images" class="js-masonry" data-masonry-options='{ "columnWidth": 200, "itemSelector": ".item" }'>
</div>
<div id="controls">
	<button id="random">click here to load (more) random images</button><br>
	<button id="automatic">automatically refresh every 10 seconds</button>
	<button id="minutes">automatically refresh every 3 minutes</button><br>
	<button id="stahp">stop refreshing</button><br>
	alternate: R to reload, ESC or click an image to clear any auto refresh
</div>
<span id="disclaimer">
		<p>By using this service, you agree to <a href="http://imgur.com/removalrequest/">report</a> anything that violates Imgur's <a href="http://imgur.com/tos">TOS</p>
</span>
</body>
</html>
